loggie:
  reload:
    enabled: true
    period: 10s

  monitor:
    logger:
      period: 30s
      enabled: true
    listeners:
      logAlert:
        addr: [ "http://127.0.0.1:8080/loggie" ]
        bufferSize: 100
        batchTimeout: 10s
        batchSize: 10
        template: |+
          {
                  "alerts":
                  [
                  {{$first := true}}
                  {{range .Alerts}}
                  {{if $first}}{{$first = false}}{{else}},{{end}}
                  {
                        "labels": {
                          "host": "{{.Event.Host}}",
                          "source": "{{.Event.Source}}"
                        },
                        "annotations": {
                          "message": "{{.Event.Message}}",
                          "filename": "{{.State.Filename}}",
                          "reason": "{{.Event.Reason}}"
                        },
                        "startsAt": "{{.System.Time}}",
                        "endsAt": "{{.System.Time}}"
                  }
                  {{end}}
                  ],
                  "commonLabels":{
                  "namespace":"ns-test",
                  "module":"module-test",
                  "alertname":"alert-test",
                  "cluster":"cluster"
                  }
          }
      filesource: ~
      filewatcher: ~
      reload: ~
      sink: ~
      queue: ~
      pipeline: ~
      normalize: ~

  discovery:
    enabled: false
    kubernetes:
      containerRuntime: containerd
      kubeconfig: ~/.kube/config
      typePodFields:
        namespace: "${_k8s.pod.namespace}"
        podname: "${_k8s.pod.name}"
        containername: "${_k8s.pod.container.name}"
        nodename: "${_k8s.node.name}"
        logconfig: "${_k8s.logconfig}"

  defaults:
    sink:
      type: dev
      printEvents: true
      codec:
        type: json
        pretty: true
    sources:
      - type: file
        watcher:
          cleanFiles:
            maxHistory: 1
  http:
    enabled: true
