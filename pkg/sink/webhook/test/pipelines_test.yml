pipelines:
  - name: local
    sources:
      - type: file
        name: demo
        paths:
          - /Users/zzy/Downloads/test/temp.txt
        fields:
          topic: "loggie"
    interceptors:
      - type: logAlert
        matcher:
          contains: ["error","err"]
          regexp: ['.*WARN.*']
        ignore: ['.*INFO.*']
        advanced:
          enable: true
          mode: [ "noData","regexp" ]
          duration: 20
          matchType: "any"
          rules:
            - regexp: '(?<date>.*?) (?<time>[\S|\\.]+)  (?<status>[\S|\\.]+) (?<u>.*?) --- (?<thread>\[.*?\]) (?<pkg>.*) : (?<message>.*)'
              key: status
              operator: "eq"
              value: WARN
            - regexp: '(?<date>.*?) (?<time>[\S|\\.]+)  (?<status>[\S|\\.]+) (?<u>.*?) --- (?<thread>\[.*?\]) (?<pkg>.*) : (?<message>.*)'
              key: u
              operator: "eq"
              value: 0.5
    sink:
      type: webhook
      addr: http://localhost:8080/loggie
      headers:
        api: test1
      template: |+
        {
        "alerts":
        [
        {{$first := true}}
        {{range .Alerts}}
        {{if $first}}{{$first = false}}{{else}},{{end}}
        {
              "labels": {
                "topic": "{{.fields.topic}}"
              },
              "annotations": {
                "message": "{{.body}}",
                "reason": "{{.reason}}"
              },
              "startsAt": "{{._meta.timestamp}}",
              "endsAt": "{{._meta.timestamp}}"
        }
        {{end}}
        ],
        "commonLabels":{
        "namespace":"ns-test",
        "module":"module-test",
        "alertname":"alert-test",
        "cluster":"cluster"
        }
        }